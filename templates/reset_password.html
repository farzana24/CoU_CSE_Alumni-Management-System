{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="text-center">Reset Password</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('reset_password') }}">
                        <div class="row">
                            <div class="col-md-6 mb-3 position-relative">
                                <label for="password" class="form-label">New Password</label>
                                <div class="position-relative">
                                    <input type="password" class="form-control pe-5" id="password" name="password" required>
                                    <button type="button" class="toggle-password-btn" data-target="password" aria-label="Show password">
                                        <img src="{{ url_for('static', filename='symbols/non_visible.svg') }}" alt="Toggle" class="eye-icon">
                                    </button>
                                </div>
                                <small class="form-text text-muted">
                                    Must contain at least 8 characters, including uppercase, lowercase, number, and special character.
                                </small>
                            </div>
                            <div class="col-md-6 mb-3 position-relative">
                                <label for="confirm_password" class="form-label">Confirm New Password</label>
                                <div class="position-relative">
                                    <input type="password" class="form-control pe-5" id="confirm_password" name="confirm_password" required>
                                    <button type="button" class="toggle-password-btn" data-target="confirm_password" aria-label="Show confirm password">
                                        <img src="{{ url_for('static', filename='symbols/non_visible.svg') }}" alt="Toggle" class="eye-icon">
                                    </button>
                                </div>
                                <div id="passwordHelp" class="form-text"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="submitBtn">Reset Password</button>
                    </form>
                    <div class="mt-3 text-center">
                        {% if session.get('reset_user_type') == 'student' %}
                            <p>Remember your password? <a href="{{ url_for('student_login') }}">Student Login</a></p>
                        {% elif session.get('reset_user_type') == 'teacher' %}
                            <p>Remember your password? <a href="{{ url_for('teacher_login') }}">Teacher Login</a></p>
                        {% else %}
                            <p>Remember your password? <a href="{{ url_for('login') }}">Alumni Login</a></p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .toggle-password-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .eye-icon { width:20px; height:20px; }
    #passwordHelp { font-size: 0.85rem; }
    #passwordHelp.text-danger { color:#dc3545 !important; }
    #passwordHelp.text-success { color:#198754 !important; }
</style>
<script>
    (function(){
        // Toggle password visibility
        const toggleButtons = document.querySelectorAll('.toggle-password-btn');
        toggleButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.getAttribute('data-target');
                const input = document.getElementById(targetId);
                const img = btn.querySelector('img');
                if(input.type === 'password') {
                    input.type = 'text';
                    img.src = "{{ url_for('static', filename='symbols/visible.svg') }}";
                    btn.setAttribute('aria-label','Hide password');
                } else {
                    input.type = 'password';
                    img.src = "{{ url_for('static', filename='symbols/non_visible.svg') }}";
                    btn.setAttribute('aria-label','Show password');
                }
            });
        });

        // Confirm password live check
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');
        const help = document.getElementById('passwordHelp');
        const submitBtn = document.getElementById('submitBtn');

        function validateMatch(){
            if(!password.value || !confirmPassword.value){
                help.textContent = '';
                help.className = 'form-text';
                submitBtn.disabled = false;
                return;
            }
            if(password.value !== confirmPassword.value){
                help.textContent = 'Passwords do not match';
                help.className = 'form-text text-danger';
                submitBtn.disabled = true;
            } else {
                help.textContent = 'Passwords match';
                help.className = 'form-text text-success';
                submitBtn.disabled = false;
            }
        }
        password.addEventListener('input', validateMatch);
        confirmPassword.addEventListener('input', validateMatch);
    })();
</script>
{% endblock %}