{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4>Privacy & Security</h4>
                </div>
                <div class="card-body">
                    <h5>Change Password</h5>
                    <form method="POST" action="{{ url_for('student_privacy_security') }}">
                        <div class="mb-3 position-relative">
                            <label for="current_password" class="form-label">Current Password</label>
                            <div class="position-relative">
                                <input type="password" class="form-control pe-5" id="current_password" name="current_password" required>
                                <button type="button" class="toggle-password-btn" data-target="current_password" aria-label="Show password">
                                    <img src="{{ url_for('static', filename='symbols/non_visible.svg') }}" alt="Toggle" class="eye-icon">
                                </button>
                            </div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label for="new_password" class="form-label">New Password</label>
                            <div class="position-relative">
                                <input type="password" class="form-control pe-5" id="new_password" name="new_password" required>
                                <button type="button" class="toggle-password-btn" data-target="new_password" aria-label="Show new password">
                                    <img src="{{ url_for('static', filename='symbols/non_visible.svg') }}" alt="Toggle" class="eye-icon">
                                </button>
                            </div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label for="confirm_password" class="form-label">Confirm New Password</label>
                            <div class="position-relative">
                                <input type="password" class="form-control pe-5" id="confirm_password" name="confirm_password" required>
                                <button type="button" class="toggle-password-btn" data-target="confirm_password" aria-label="Show confirm password">
                                    <img src="{{ url_for('static', filename='symbols/non_visible.svg') }}" alt="Toggle" class="eye-icon">
                                </button>
                            </div>
                            <div id="passwordHelp" class="form-text"></div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="submitBtn">Update Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .toggle-password-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .eye-icon { 
        width: 20px; 
        height: 20px; 
    }
    #passwordHelp { 
        font-size: 0.85rem; 
    }
    #passwordHelp.text-danger { 
        color: #dc3545 !important; 
    }
    #passwordHelp.text-success { 
        color: #198754 !important; 
    }
</style>

<script>
    (function(){
        // Toggle password visibility for all password fields
        const toggleButtons = document.querySelectorAll('.toggle-password-btn');
        toggleButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.getAttribute('data-target');
                const input = document.getElementById(targetId);
                const img = btn.querySelector('img');
                if(input.type === 'password') {
                    input.type = 'text';
                    img.src = "{{ url_for('static', filename='symbols/visible.svg') }}";
                    btn.setAttribute('aria-label', 'Hide password');
                } else {
                    input.type = 'password';
                    img.src = "{{ url_for('static', filename='symbols/non_visible.svg') }}";
                    btn.setAttribute('aria-label', 'Show password');
                }
            });
        });

        // Confirm password live check
        const newPassword = document.getElementById('new_password');
        const confirmPassword = document.getElementById('confirm_password');
        const help = document.getElementById('passwordHelp');
        const submitBtn = document.getElementById('submitBtn');

        function validateMatch(){
            if(!newPassword.value || !confirmPassword.value){
                help.textContent = '';
                help.className = 'form-text';
                submitBtn.disabled = false;
                return;
            }
            if(newPassword.value !== confirmPassword.value){
                help.textContent = 'Passwords do not match';
                help.className = 'form-text text-danger';
                submitBtn.disabled = true;
            } else {
                help.textContent = 'Passwords match';
                help.className = 'form-text text-success';
                submitBtn.disabled = false;
            }
        }
        newPassword.addEventListener('input', validateMatch);
        confirmPassword.addEventListener('input', validateMatch);
    })();
</script>
{% endblock %}