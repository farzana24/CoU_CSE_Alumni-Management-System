{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="text-center">Student Registration</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('student_signup') }}" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" name="username" 
                                    value="{{ student_data.username if student_data }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" 
                                    value="{{ student_data.email if student_data }}" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3 position-relative">
                                <label for="password" class="form-label">Password</label>
                                <div class="position-relative">
                                    <input type="password" class="form-control pe-5" id="password" name="password" required>
                                    <button type="button" class="toggle-password-btn" data-target="password" aria-label="Show password">
                                        <img src="{{ url_for('static', filename='symbols/non_visible.svg') }}" alt="Toggle" class="eye-icon">
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3 position-relative">
                                <label for="confirm_password" class="form-label">Confirm Password</label>
                                <div class="position-relative">
                                    <input type="password" class="form-control pe-5" id="confirm_password" name="confirm_password" required>
                                    <button type="button" class="toggle-password-btn" data-target="confirm_password" aria-label="Show confirm password">
                                        <img src="{{ url_for('static', filename='symbols/non_visible.svg') }}" alt="Toggle" class="eye-icon">
                                    </button>
                                </div>
                                <div id="passwordHelp" class="form-text"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                    value="{{ student_data.name if student_data }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="student_id" class="form-label">Student ID</label>
                                <input type="text" class="form-control" id="student_id" name="student_id" 
                                    value="{{ student_data.student_id if student_data }}" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="batch" class="form-label">Batch</label>
                                <input type="text" class="form-control" id="batch" name="batch" 
                                    value="{{ student_data.batch if student_data }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone</label>
                                <input type="text" class="form-control" id="phone" name="phone" 
                                    value="{{ student_data.phone if student_data }}">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="photo" class="form-label">Profile Photo</label>
                            <input type="file" class="form-control" id="photo" name="photo" accept="image/*">
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="submitBtn">Register</button>
                    </form>
                    <div class="mt-3 text-center">
                        <p>Already have an account? <a href="{{ url_for('student_login') }}">Login</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .toggle-password-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .eye-icon { width:20px; height:20px; }
    #passwordHelp { font-size: 0.85rem; }
    #passwordHelp.text-danger { color:#dc3545 !important; }
    #passwordHelp.text-success { color:#198754 !important; }
</style>
<script>
    (function(){
        const toggleButtons = document.querySelectorAll('.toggle-password-btn');
        toggleButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.getAttribute('data-target');
                const input = document.getElementById(targetId);
                const img = btn.querySelector('img');
                if(input.type === 'password') {
                    input.type = 'text';
                    img.src = "{{ url_for('static', filename='symbols/visible.svg') }}";
                    btn.setAttribute('aria-label','Hide password');
                } else {
                    input.type = 'password';
                    img.src = "{{ url_for('static', filename='symbols/non_visible.svg') }}";
                    btn.setAttribute('aria-label','Show password');
                }
            });
        });

        // Confirm password live check
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');
        const help = document.getElementById('passwordHelp');
        const submitBtn = document.getElementById('submitBtn');

        function validateMatch(){
            if(!password.value || !confirmPassword.value){
                help.textContent = '';
                help.className = 'form-text';
                submitBtn.disabled = false;
                return;
            }
            if(password.value !== confirmPassword.value){
                help.textContent = 'Passwords do not match';
                help.className = 'form-text text-danger';
                submitBtn.disabled = true;
            } else {
                help.textContent = 'Passwords match';
                help.className = 'form-text text-success';
                submitBtn.disabled = false;
            }
        }
        password.addEventListener('input', validateMatch);
        confirmPassword.addEventListener('input', validateMatch);
    })();
</script>
{% endblock %}